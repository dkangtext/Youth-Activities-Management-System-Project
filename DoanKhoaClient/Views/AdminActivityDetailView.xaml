<Window
    x:Class="DoanKhoaClient.Views.AdminActivityDetailView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:DoanKhoaClient.Converters"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Name="Admin_ActivityDetail_View"
    Title="Quản lý chi tiết hoạt động"
    MinWidth="1200"
    MinHeight="800"
    WindowStartupLocation="CenterScreen"
    WindowState="Maximized"
    mc:Ignorable="d">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <local:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter" />
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <local:StringNotEmptyToBoolConverter x:Key="StringNotEmptyToBoolConverter" />
        <local:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <local:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <local:IndentToWidthConverter x:Key="IndentToWidthConverter" />

        <!--  Tab Button Style  -->
        <Style x:Key="TabButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="20,10" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#6c757d" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Padding="{TemplateBinding Padding}"
                            Background="{TemplateBinding Background}"
                            CornerRadius="5,5,0,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F8F9FA" />
                </Trigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Tag}" Value="Active">
                    <Setter Property="Background" Value="#FF12305E" />
                    <Setter Property="Foreground" Value="White" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!--  Primary Button Style  -->
        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF12305E" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Padding" Value="15,8" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Padding="{TemplateBinding Padding}"
                            Background="{TemplateBinding Background}"
                            CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A6483" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  Danger Button Style  -->
        <Style x:Key="DangerButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#e74c3c" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Padding" Value="10,5" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            Padding="{TemplateBinding Padding}"
                            Background="{TemplateBinding Background}"
                            CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#c0392b" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  Card Style  -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="20" />
            <Setter Property="Margin" Value="0,0,0,15" />
        </Style>
    </Window.Resources>

    <Grid x:Name="Admin_ActivityDetail_Background">
        <Grid.Background>
            <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                <GradientStop Offset="0.596" Color="#FFF6FCFF" />
                <GradientStop Offset="1" Color="#FFDBF3FF" />
            </LinearGradientBrush>
        </Grid.Background>

        <!--  Header  -->
        <Border
            Height="80"
            Margin="20,20,20,0"
            VerticalAlignment="Top"
            Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Back Button  -->
                <Button
                    Grid.Column="0"
                    Width="100"
                    Height="36"
                    Click="BackButton_Click"
                    Content="← Quay lại"
                    Style="{StaticResource PrimaryButtonStyle}" />

                <!--  Title  -->
                <StackPanel
                    Grid.Column="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <TextBlock
                        FontSize="24"
                        FontWeight="Bold"
                        Foreground="#FF12305E"
                        Text="{Binding Activity.Title}"
                        TextAlignment="Center" />
                    <TextBlock
                        FontSize="14"
                        Foreground="#6c757d"
                        Text="{Binding Activity.Date, StringFormat='Ngày: {0:dd/MM/yyyy}'}"
                        TextAlignment="Center" />
                </StackPanel>

                <!--  Action Buttons  -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button
                        Margin="0,0,10,0"
                        Command="{Binding EditActivityCommand}"
                        Content="Chỉnh sửa"
                        Style="{StaticResource PrimaryButtonStyle}" />
                    <Button
                        Command="{Binding DeleteActivityCommand}"
                        Content="Xóa"
                        Style="{StaticResource DangerButtonStyle}" />
                </StackPanel>
            </Grid>
        </Border>

        <!--  Tab Navigation  -->
        <Border
            Height="50"
            Margin="20,120,20,0"
            VerticalAlignment="Top"
            Background="White"
            BorderBrush="#E0E0E0"
            BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <Button
                    x:Name="OverviewTab"
                    Click="OverviewTab_Click"
                    Content="Tổng quan"
                    Style="{StaticResource TabButtonStyle}"
                    Tag="Active" />
                <Button
                    x:Name="ParticipantsTab"
                    Click="ParticipantsTab_Click"
                    Content="Người tham gia"
                    Style="{StaticResource TabButtonStyle}" />
                <Button
                    x:Name="LikesTab"
                    Click="LikesTab_Click"
                    Content="Lượt thích"
                    Style="{StaticResource TabButtonStyle}" />
                <Button
                    x:Name="CommentsTab"
                    Click="CommentsTab_Click"
                    Content="Bình luận"
                    Style="{StaticResource TabButtonStyle}" />
            </StackPanel>
        </Border>

        <!--  Tab Content  -->
        <ScrollViewer Margin="20,190,20,20" VerticalScrollBarVisibility="Auto">
            <Grid>
                <!--  Overview Tab  -->
                <StackPanel x:Name="OverviewContent" Visibility="Visible">
                    <!--  Statistics Cards  -->
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!--  Participants Card  -->
                        <Border
                            Grid.Column="0"
                            Margin="0,0,10,0"
                            Style="{StaticResource CardStyle}">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock FontSize="28" Text="👥" />
                                <TextBlock
                                    FontSize="32"
                                    FontWeight="Bold"
                                    Foreground="#FF12305E"
                                    Text="{Binding Activity.ParticipantCount}" />
                                <TextBlock
                                    FontSize="16"
                                    Foreground="#6c757d"
                                    Text="Người tham gia" />
                            </StackPanel>
                        </Border>

                        <!--  Likes Card  -->
                        <Border
                            Grid.Column="1"
                            Margin="5,0,5,0"
                            Style="{StaticResource CardStyle}">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock FontSize="28" Text="❤️" />
                                <TextBlock
                                    FontSize="32"
                                    FontWeight="Bold"
                                    Foreground="#e74c3c"
                                    Text="{Binding Activity.LikeCount}" />
                                <TextBlock
                                    FontSize="16"
                                    Foreground="#6c757d"
                                    Text="Lượt thích" />
                            </StackPanel>
                        </Border>

                        <!--  Comments Card  -->
                        <Border
                            Grid.Column="2"
                            Margin="10,0,0,0"
                            Style="{StaticResource CardStyle}">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock FontSize="28" Text="💬" />
                                <TextBlock
                                    FontSize="32"
                                    FontWeight="Bold"
                                    Foreground="#3498db"
                                    Text="{Binding CommentsCount}" />
                                <TextBlock
                                    FontSize="16"
                                    Foreground="#6c757d"
                                    Text="Bình luận" />
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!--  Activity Details  -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock
                                FontSize="18"
                                FontWeight="Bold"
                                Foreground="#FF12305E"
                                Text="Chi tiết hoạt động" />

                            <!--  Activity Image  -->
                            <Image
                                MaxWidth="500"
                                Margin="0,15,0,15"
                                HorizontalAlignment="Center"
                                Source="{Binding Activity.ImgUrl}"
                                Stretch="Uniform" />

                            <!--  Activity Info  -->
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Margin="0,0,20,10"
                                    FontWeight="Bold"
                                    Text="Loại:" />
                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Margin="0,0,0,10"
                                    Text="{Binding Activity.Type}" />

                                <TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Margin="0,0,20,10"
                                    FontWeight="Bold"
                                    Text="Trạng thái:" />
                                <TextBlock
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Margin="0,0,0,10"
                                    Text="{Binding Activity.Status}" />

                                <TextBlock
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Margin="0,0,20,10"
                                    FontWeight="Bold"
                                    Text="Ngày tạo:" />
                                <TextBlock
                                    Grid.Row="2"
                                    Grid.Column="1"
                                    Margin="0,0,0,10"
                                    Text="{Binding Activity.CreatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />

                                <TextBlock
                                    Grid.Row="3"
                                    Grid.Column="0"
                                    Margin="0,0,20,10"
                                    FontWeight="Bold"
                                    Text="Mô tả:" />
                                <TextBlock
                                    Grid.Row="3"
                                    Grid.Column="1"
                                    Margin="0,0,0,10"
                                    Text="{Binding Activity.Description}"
                                    TextWrapping="Wrap" />
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!--  Participants Tab  -->
                <StackPanel x:Name="ParticipantsContent" Visibility="Collapsed">
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <Grid Margin="0,0,0,20">
                                <TextBlock
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Foreground="#FF12305E"
                                    Text="Danh sách người tham gia" />
                                <Button
                                    HorizontalAlignment="Right"
                                    Command="{Binding RefreshParticipantsCommand}"
                                    Content="Làm mới"
                                    Style="{StaticResource PrimaryButtonStyle}" />
                            </Grid>

                            <ListView ItemsSource="{Binding Participants}" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,5"
                                            Padding="15,10"
                                            Background="#F8F9FA"
                                            CornerRadius="5">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!--  Avatar  -->
                                                <Border
                                                    Grid.Column="0"
                                                    Width="40"
                                                    Height="40"
                                                    Background="#E0E0E0"
                                                    CornerRadius="20">
                                                    <Image Source="{Binding AvatarUrl}" Stretch="UniformToFill" />
                                                </Border>

                                                <!--  User Info  -->
                                                <StackPanel
                                                    Grid.Column="1"
                                                    Margin="15,0,0,0"
                                                    VerticalAlignment="Center">
                                                    <TextBlock FontWeight="Bold" Text="{Binding DisplayName}" />
                                                    <TextBlock
                                                        FontSize="12"
                                                        Foreground="#6c757d"
                                                        Text="{Binding Email}" />
                                                </StackPanel>

                                                <!--  Join Date  -->
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Margin="10,0"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    Foreground="#6c757d"
                                                    Text="{Binding JoinedAt, StringFormat='Tham gia: {0:dd/MM/yyyy}'}" />

                                                <!--  Remove Button  -->
                                                <Button
                                                    Grid.Column="3"
                                                    Command="{Binding DataContext.RemoveParticipantCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Content="Xóa"
                                                    Style="{StaticResource DangerButtonStyle}" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!--  Likes Tab  -->
                <StackPanel x:Name="LikesContent" Visibility="Collapsed">
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <Grid Margin="0,0,0,20">
                                <TextBlock
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Foreground="#FF12305E"
                                    Text="Danh sách người thích" />
                                <Button
                                    HorizontalAlignment="Right"
                                    Command="{Binding RefreshLikesCommand}"
                                    Content="Làm mới"
                                    Style="{StaticResource PrimaryButtonStyle}" />
                            </Grid>

                            <ListView ItemsSource="{Binding LikedUsers}" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,5"
                                            Padding="15,10"
                                            Background="#FFF5F5"
                                            CornerRadius="5">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!--  Avatar  -->
                                                <Border
                                                    Grid.Column="0"
                                                    Width="40"
                                                    Height="40"
                                                    Background="#E0E0E0"
                                                    CornerRadius="20">
                                                    <Image Source="{Binding AvatarUrl}" Stretch="UniformToFill" />
                                                </Border>

                                                <!--  User Info  -->
                                                <StackPanel
                                                    Grid.Column="1"
                                                    Margin="15,0,0,0"
                                                    VerticalAlignment="Center">
                                                    <TextBlock FontWeight="Bold" Text="{Binding DisplayName}" />
                                                    <TextBlock
                                                        FontSize="12"
                                                        Foreground="#6c757d"
                                                        Text="{Binding Email}" />
                                                </StackPanel>

                                                <!--  Like Date  -->
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Margin="10,0"
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    Foreground="#6c757d"
                                                    Text="{Binding LikedAt, StringFormat='Thích: {0:dd/MM/yyyy}'}" />

                                                <!--  Remove Like Button  -->
                                                <Button
                                                    Grid.Column="3"
                                                    Command="{Binding DataContext.RemoveLikeCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Content="Xóa"
                                                    Style="{StaticResource DangerButtonStyle}" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!--  Comments Tab  -->
                <StackPanel x:Name="CommentsContent" Visibility="Collapsed">
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <Grid Margin="0,0,0,20">
                                <TextBlock
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Foreground="#FF12305E"
                                    Text="Quản lý bình luận" />
                                <Button
                                    HorizontalAlignment="Right"
                                    Command="{Binding RefreshCommentsCommand}"
                                    Content="Làm mới"
                                    Style="{StaticResource PrimaryButtonStyle}" />
                            </Grid>

                            <ListView ItemsSource="{Binding Comments}" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,5"
                                            Padding="15,10"
                                            Background="#F0F8FF"
                                            CornerRadius="5">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!--  Avatar  -->
                                                <Border
                                                    Grid.Column="0"
                                                    Width="40"
                                                    Height="40"
                                                    Background="#E0E0E0"
                                                    CornerRadius="20">
                                                    <Image Source="{Binding UserAvatar}" Stretch="UniformToFill" />
                                                </Border>

                                                <!--  Comment Info  -->
                                                <StackPanel Grid.Column="1" Margin="15,0,0,0">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock FontWeight="Bold" Text="{Binding UserDisplayName}" />
                                                        <TextBlock
                                                            Margin="10,0,0,0"
                                                            FontSize="12"
                                                            Foreground="#6c757d"
                                                            Text="{Binding TimeAgo}" />
                                                        <TextBlock
                                                            Margin="10,0,0,0"
                                                            FontSize="12"
                                                            Foreground="#e74c3c"
                                                            Text="{Binding LikeCount, StringFormat='❤️ {0}'}"
                                                            Visibility="{Binding LikeCount, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" />
                                                    </StackPanel>
                                                    <TextBlock
                                                        Margin="0,5,0,0"
                                                        Text="{Binding Content}"
                                                        TextWrapping="Wrap" />
                                                    <TextBlock
                                                        Margin="0,2,0,0"
                                                        FontSize="10"
                                                        FontStyle="Italic"
                                                        Foreground="#6c757d"
                                                        Text="Phản hồi"
                                                        Visibility="{Binding IsReply, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                </StackPanel>

                                                <!--  Comment Actions  -->
                                                <StackPanel
                                                    Grid.Column="2"
                                                    Margin="10,0"
                                                    Orientation="Horizontal">
                                                    <Button
                                                        Margin="0,0,5,0"
                                                        Command="{Binding DataContext.EditCommentCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Content="Sửa"
                                                        Style="{StaticResource PrimaryButtonStyle}" />
                                                </StackPanel>

                                                <!--  Delete Button  -->
                                                <Button
                                                    Grid.Column="3"
                                                    Command="{Binding DataContext.DeleteCommentCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Content="Xóa"
                                                    Style="{StaticResource DangerButtonStyle}" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Window>